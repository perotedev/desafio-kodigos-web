<div class="pb-3">
  <div
    class="mb-3 flex align-items-center gap-3"
    [class.justify-content-between]="!isMobile()"
    [class.flex-column]="isMobile()"
  >
    <div [ngStyle]="{width: isMobile() ? '100%' : '260px'}">
      <app-input-search [(value)]="search"/>
    </div>

    <div [class.w-full]="isMobile()">
      <p-button
        (onClick)="toggleDialog()"
        styleClass="px-3 {{isMobile() ? 'w-full' : 'w-auto'}}"
        label="Adicionar"
        icon="pi pi-plus"
      />
    </div>
  </div>

  <app-content-list
    [dataList]="contracts()"
    [isMobile]="isMobile()"
    [isLoading]="isLoadingContracts()"
    [paginator]="true"
    [rows]="size"
    [first]="1"
    [totalRecords]="total"
    [rowsPerPageOptions]="[10, 20, 30]"
    (onPageChange)="onPageChange($event)"
  >
    <span cl-header [autoCol]="false" style="width: 70px;">ID</span>
    <ng-template clTCell [mobileHiden]="true" let-item>
      <span cl-cell [autoCol]="false" style="width: 70px">{{item.id}}</span>
    </ng-template>

    <span cl-header [autoCol]="false" style="width: 150px;">Número</span>
    <ng-template clTCell let-item>
      <span cl-cell [autoCol]="false" style="width: 150px;">{{item.number}}</span>
    </ng-template>

    <span cl-header>Cliente</span>
    <ng-template clTCell let-item>
      <span cl-cell>{{item.client.name || "Não identificado"}}</span>
    </ng-template>

    <span cl-header [autoCol]="false" style="width: 120px;">Data Início</span>
    <ng-template clTCell let-item>
      <span cl-cell [autoCol]="false" style="width: 120px;">{{item.date_start | date: "dd/MM/yy"}}</span>
    </ng-template>

    <span cl-header [autoCol]="false" style="width: 120px;">Data Fim</span>
    <ng-template clTCell let-item>
      <span cl-cell [autoCol]="false" style="width: 120px;">{{item.date_end | date: "dd/MM/yy"}}</span>
    </ng-template>

    <span cl-header [autoCol]="false" class="col-2 xl:col-1">Valor</span>
    <ng-template clTCell let-item>
      <span cl-cell [autoCol]="false" class="col-2 xl:col-1">{{item.value | currency: "BRL"}}</span>
    </ng-template>

    <span cl-header [autoCol]="false" style="width: 72px;" class="text-right"></span>
    <ng-template clTCell [isAction]="true" let-item>
      <span cl-cell [autoCol]="false" style="width: 72px;" class="text-right">
        <p-button (onClick)="toggleDialog(item)" size="small" styleClass="px-2" [rounded]="true" [text]="true">
          <span class="pi pi-eye"></span>
        </p-button>
      </span>
    </ng-template>
  </app-content-list>
</div>


<p-dialog
  header="{{selectedContract()?'Editar':'Adicionar'}} Contrato"
  [(visible)]="dialogVisible"
  [modal]="true"
  [style]="{width: isMobile()?'90%':'380px'}"
>
  @if(dialogVisible) {
    <app-contract-form
      [editContract]="selectedContract()"
      [clients]="clients()"
      (onSaveContract)="onSaveCotract($event)"
    />
  }
</p-dialog>
